<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Guide Dog PREP Tracker</title>
    <meta name="description" content="Guide Dog Puppy Raising and Education Programme Progress Tracker">
    <meta name="theme-color" content="#1E40AF">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="apple-touch-icon" href="icon-192.svg">
    <link rel="icon" type="image/svg+xml" sizes="192x192" href="icon-192.svg">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles/main.css">

    <!-- Quill WYSIWYG Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
                <div class="paw-icon">ü¶Æ</div>
            <h2>Guide Dog PREP Tracker</h2>
            <div class="loading-spinner"></div>
        </div>
    </div>

    <!-- App Container -->
    <div id="app" class="app-container" style="display: none;">
        
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">
                    <span class="paw-icon">ü¶Æ</span>
                    PREP Tracker
                    <span id="appVersion" class="app-version"></span>
                </h1>
                <button id="menuBtn" class="menu-btn">
                    <span class="hamburger"></span>
                </button>
            </div>
            <div id="puppyInfo" class="puppy-info" style="display: none;">
                <span id="puppyName"></span> ‚Ä¢ <span id="puppyAge"></span>
            </div>
        </header>

        <!-- Navigation Menu -->
        <nav id="navMenu" class="nav-menu">
            <div class="nav-content">
                <button class="nav-item" data-view="puppies">
                    <span class="nav-icon">ü¶Æ</span>
                    My Puppies
                </button>
                <button class="nav-item active" data-view="dashboard">
                    <span class="nav-icon">üéØ</span>
                    Dashboard
                </button>
                <button class="nav-item" data-view="progress">
                    <span class="nav-icon">üìä</span>
                    Progress Chart
                </button>
                <button class="nav-item" data-view="diary">
                    <span class="nav-icon">üìñ</span>
                    Diary
                </button>
                <button class="nav-item" data-view="supporting">
                    <span class="nav-icon">üìö</span>
                    Supporting Documents
                </button>
                <button class="nav-item" data-view="profile">
                    <span class="nav-icon">üêæ</span>
                    Puppy Profile
                </button>
                <button class="nav-item" data-view="tools">
                    <span class="nav-icon">üîß</span>
                    Tools
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">

            <!-- Puppy Management View -->
            <div id="puppiesView" class="view">
                <div class="view-header">
                    <h2>My Puppies</h2>
                    <p>Manage and switch between your puppy profiles</p>
                </div>
                
                <div id="puppySelector" class="puppy-selector">
                    <div class="current-puppy-header">
                        <h3>Current Puppy</h3>
                        <div id="currentPuppyDisplay" class="current-puppy-display">
                            <p>No puppy selected</p>
                            <button id="addFirstPuppyBtn" class="primary-btn">Add Your First Puppy</button>
                        </div>
                    </div>
                    
                    <div class="puppy-management">
                        <div class="section-header">
                            <h3>All Puppies</h3>
                            <button id="addPuppyBtn" class="primary-btn" style="display: none;">
                                ‚ûï Add New Puppy
                            </button>
                        </div>
                        <div id="puppyList" class="puppy-list">
                            <!-- Puppy cards will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Dashboard View -->
            <div id="dashboardView" class="view" style="display: none;">
                <div class="view-header dashboard-header">
                    <h2>Dashboard</h2>
                </div>
                
                <div class="dashboard-content">
                    <div class="dashboard-grid">
                        <!-- Progress rings will be dynamically generated here -->
                    </div>
                    
                    <!-- Puppy selector bar at bottom -->
                    <div class="puppy-selector-bar">
                        <!-- Clickable puppy bars will be generated here -->
                    </div>
                </div>
            </div>
            
            <!-- Puppy Profile Setup View -->
            <div id="profileView" class="view" style="display: none;">
                <div class="view-header">
                    <h2>Puppy Profile</h2>
                    <p>Set up your puppy's information</p>
                </div>
                
                <form id="profileForm" class="profile-form">
                    <div class="form-group">
                        <label for="puppyName">Puppy Name *</label>
                        <input type="text" id="puppyNameInput" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="computerNumber">Computer Number</label>
                        <input type="text" id="computerNumber" placeholder="e.g. GD12345">
                    </div>
                    
                    <div class="form-group">
                        <label for="dateOfBirth">Date of Birth *</label>
                        <input type="date" id="dateOfBirth" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="breed">Breed</label>
                        <select id="breed">
                            <option value="">Select breed...</option>
                            <option value="Labrador">Labrador</option>
                            <option value="Golden Retriever">Golden Retriever</option>
                            <option value="German Shepherd">German Shepherd</option>
                            <option value="Labradoodle">Labradoodle</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="primary-btn">Save Profile</button>
                    </div>
                </form>
            </div>

            <!-- Progress Chart View -->
            <div id="progressView" class="view" style="display: none;">
                <div class="view-header">
                    <h2>Progress Chart</h2>
                    <p>Track your puppy's development across different training areas</p>
                </div>
                
                <div id="progressGrid" class="progress-grid">
                    <!-- Training areas will be dynamically generated -->
                </div>
            </div>

            <!-- Diary View -->
            <div id="diaryView" class="view" style="display: none;">
                <!-- Diary Page Container -->
                <div class="diary-container">
                    
                    <!-- Diary Date Header -->
                    <div class="diary-date-header">
                        <h1 id="diaryDateHeader" class="diary-date"></h1>
                        <div class="diary-date-line"></div>
                    </div>
                    
                    <!-- Diary Controls -->
                    <div class="diary-controls">
                        <div class="diary-filters">
                            <div class="diary-filter">
                                <select id="diaryBehaviorFilter" class="diary-filter-select">
                                    <option value="all">All Behaviours</option>
                                    <option value="toileting">Toileting Routine</option>
                                    <option value="play">Learning to Play</option>
                                    <option value="greeting">Greeting People</option>
                                    <option value="manners">Learning Manners</option>
                                    <option value="transport">Travel and Transport</option>
                                    <option value="walking">Walking on a Lead</option>
                                    <option value="recall">Recall and Off Lead Exercise</option>
                                    <option value="handling">Handling, Grooming and Equipment</option>
                                    <option value="outing">Being Out and About</option>
                                    <option value="social">Social Behaviours and Settling</option>
                                </select>
                            </div>
                            
                            <div class="diary-filter">
                                <input type="date" id="diaryDateFilter" class="diary-filter-input" placeholder="Filter by date">
                            </div>
                        </div>
                        
                        <div class="diary-actions">
                            <button id="clearDiaryFilters" class="diary-btn secondary">Clear</button>
                            <button id="addDiaryEntryBtn" class="diary-btn primary">
                                ‚úçÔ∏è Add Entry
                            </button>
                        </div>
                    </div>
                    
                    <!-- Diary Page Content -->
                    <div class="diary-page" id="diaryPage">
                        <div class="diary-entries" id="diaryEntries">
                            <!-- Diary entries will be dynamically loaded here -->
                        </div>
                        
                        <!-- Empty State -->
                        <div class="diary-empty-state" id="diaryEmptyState" style="display: none;">
                            <div class="empty-diary-icon">üìñ</div>
                            <h3>No entries for this day</h3>
                            <p>Add your first diary entry to start tracking your puppy's progress.</p>
                            <button class="primary-btn" onclick="app.showNewDiaryModal()">Add Entry</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Supporting Documents View -->
            <div id="supportingView" class="view" style="display: none;">
                <div class="view-header">
                    <h2>Supporting Documents</h2>
                    <p>Reference materials and guidance</p>
                </div>
                
                <div class="documents-grid">
                    <div class="document-card" data-doc="mouthing">
                        <div class="document-icon">ü¶∑</div>
                        <h3>Mouthing</h3>
                        <p>Tips to understand and manage mouthing behaviour</p>
                        <div class="document-progress">
                            <div class="progress-slider">
                                <label class="slider-label">Progress: <span class="slider-value">0%</span></label>
                                <input type="range" 
                                       class="progress-range" 
                                       min="0" 
                                       max="100" 
                                       step="5"
                                       value="0">
                                <div class="slider-markers">
                                    <span>0%</span>
                                    <span>25%</span>
                                    <span>50%</span>
                                    <span>75%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="document-card" data-doc="whistle">
                        <div class="document-icon">üéµ</div>
                        <h3>Whistle Association</h3>
                        <p>How to form an association between whistle and food</p>
                        <div class="document-progress">
                            <div class="progress-slider">
                                <label class="slider-label">Progress: <span class="slider-value">0%</span></label>
                                <input type="range" 
                                       class="progress-range" 
                                       min="0" 
                                       max="100" 
                                       step="5"
                                       value="0">
                                <div class="slider-markers">
                                    <span>0%</span>
                                    <span>25%</span>
                                    <span>50%</span>
                                    <span>75%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="document-card" data-doc="traffic">
                        <div class="document-icon">üöó</div>
                        <h3>Observing Traffic</h3>
                        <p>Introduce sights and sounds of traffic safely</p>
                        <div class="document-progress">
                            <div class="progress-slider">
                                <label class="slider-label">Progress: <span class="slider-value">0%</span></label>
                                <input type="range" 
                                       class="progress-range" 
                                       min="0" 
                                       max="100" 
                                       step="5"
                                       value="0">
                                <div class="slider-markers">
                                    <span>0%</span>
                                    <span>25%</span>
                                    <span>50%</span>
                                    <span>75%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="document-card" data-doc="harness">
                        <div class="document-icon">ü¶Æ</div>
                        <h3>T-Touch Harness</h3>
                        <p>Fitting, maintaining, and working with harness</p>
                        <div class="document-progress">
                            <div class="progress-slider">
                                <label class="slider-label">Progress: <span class="slider-value">0%</span></label>
                                <input type="range" 
                                       class="progress-range" 
                                       min="0" 
                                       max="100" 
                                       step="5"
                                       value="0">
                                <div class="slider-markers">
                                    <span>0%</span>
                                    <span>25%</span>
                                    <span>50%</span>
                                    <span>75%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="document-card" data-doc="adolescence">
                        <div class="document-icon">üå±</div>
                        <h3>Adolescence</h3>
                        <p>Managing adolescent behaviours and expectations</p>
                        <div class="document-progress">
                            <div class="progress-slider">
                                <label class="slider-label">Progress: <span class="slider-value">0%</span></label>
                                <input type="range" 
                                       class="progress-range" 
                                       min="0" 
                                       max="100" 
                                       step="5"
                                       value="0">
                                <div class="slider-markers">
                                    <span>0%</span>
                                    <span>25%</span>
                                    <span>50%</span>
                                    <span>75%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="document-card" data-doc="stairs">
                        <div class="document-icon">ü™ú</div>
                        <h3>Stairs and Steps</h3>
                        <p>Safely navigate stairs and steps with your puppy</p>
                        <div class="document-progress">
                            <div class="progress-slider">
                                <label class="slider-label">Progress: <span class="slider-value">0%</span></label>
                                <input type="range" 
                                       class="progress-range" 
                                       min="0" 
                                       max="100" 
                                       step="5"
                                       value="0">
                                <div class="slider-markers">
                                    <span>0%</span>
                                    <span>25%</span>
                                    <span>50%</span>
                                    <span>75%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tools View -->
            <div id="toolsView" class="view" style="display: none;">
                <div class="view-header">
                    <h2>Tools</h2>
                    <p>Backup, restore, and manage your data</p>
                </div>
                
                <div class="tools-grid">
                    <div class="tool-card">
                        <div class="tool-icon">üíæ</div>
                        <h3>Backup Data</h3>
                        <p>Export your puppy's progress data</p>
                        <button id="backupBtn" class="tool-btn">Export Backup</button>
                    </div>
                    
                    <div class="tool-card">
                        <div class="tool-icon">üì•</div>
                        <h3>Restore Data</h3>
                        <p>Import previously saved progress data</p>
                        <button id="restoreBtn" class="tool-btn">Import Backup</button>
                        <input type="file" id="fileInput" accept=".json" style="display: none;">
                    </div>
                    
                    <div class="tool-card">
                        <div class="tool-icon">üóëÔ∏è</div>
                        <h3>Reset Data</h3>
                        <p>Clear all data and start fresh</p>
                        <button id="resetBtn" class="tool-btn danger">Reset All Data</button>
                    </div>
                    
                    <div class="tool-card">
                        <div class="tool-icon">‚öôÔ∏è</div>
                        <h3>Changelog</h3>
                        <p>See what's new in the latest version</p>
                        <button id="changelogBtn" class="tool-btn">Show Changelog</button>
                    </div>
                </div>
            </div>

        </main>

        <!-- Activity Detail Modal -->
        <div id="activityModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">Training Activity</h3>
                    <button id="closeModal" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="activity-details">
                        <div class="form-group">
                            <label for="activityDate">Date</label>
                            <input type="date" id="activityDate">
                        </div>
                        <div class="form-group">
                            <label for="activityNotes">Notes</label>
                            <div id="activityNotesEditor"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="saveActivity" class="primary-btn">Save Activity</button>
                    <button id="cancelActivity" class="secondary-btn">Cancel</button>
                </div>
            </div>
        </div>

        <!-- New Diary Entry Modal -->
        <div id="newDiaryModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="newDiaryTitle">Add Diary Entry</h3>
                    <button id="closeNewDiaryModal" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="diary-entry-form">
                        <div class="form-group">
                            <label for="diaryEntryDate">Date *</label>
                            <input type="date" id="diaryEntryDate" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="diaryEntryBehavior">Behavior/Training Area *</label>
                            <select id="diaryEntryBehavior" required>
                                <option value="">Select behavior...</option>
                                <option value="toileting">Toileting Routine</option>
                                <option value="play">Learning to Play</option>
                                <option value="greeting">Greeting People</option>
                                <option value="manners">Learning Manners</option>
                                <option value="transport">Travel and Transport</option>
                                <option value="walking">Walking on a Lead</option>
                                <option value="recall">Recall and Off Lead Exercise</option>
                                <option value="handling">Handling, Grooming and Equipment</option>
                                <option value="outing">Being Out and About</option>
                                <option value="social">Social Behaviours and Settling</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="diaryEntryMilestone">Training Milestone *</label>
                            <select id="diaryEntryMilestone" required>
                                <option value="">Select milestone...</option>
                                <option value="12weeks">3 Months (12 Weeks)</option>
                                <option value="juvenile">6 Months (Juvenile)</option>
                                <option value="adolescent">9 Months (Adolescent)</option>
                                <option value="12months">12+ Months</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="diaryEntryNotes">Notes *</label>
                            <div id="diaryEntryNotesEditor"></div>
                            <div class="voice-input-container">
                                <button type="button" id="voiceInputBtn" class="voice-input-btn" title="Voice input">
                                    üé§
                                </button>
                                <span id="voiceStatus" class="voice-status">Click to record</span>
                                <div class="transcription-indicator"></div>
                            </div>
                            <div class="voice-powered-by">
                                Powered by <a href="https://deepgram.com" target="_blank" rel="noopener">Deepgram</a>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="diaryEntryVideo">Attach Video (Optional)</label>
                            <div class="video-upload-section">
                                <input type="file" id="diaryEntryVideo" accept="video/*" style="display: none;">
                                <button type="button" id="diaryVideoUploadBtn" class="secondary-btn small-btn">
                                    üìπ Choose Video File
                                </button>
                                <div id="diaryVideoPreview" class="video-preview" style="display: none;">
                                    <div class="video-info">
                                        <span id="diaryVideoFileName"></span>
                                        <button type="button" id="removeDiaryVideoBtn">&times;</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="saveDiaryEntry" class="primary-btn">Save Diary Entry</button>
                    <button id="cancelDiaryEntry" class="secondary-btn">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Changelog Modal -->
        <div id="changelogModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="changelogTitle">What's New</h3>
                    <button id="closeChangelogModal" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <ul id="changelogList"></ul>
                </div>
            </div>
        </div>

        <!-- Toast Messages -->
        <div id="toastContainer" class="toast-container"></div>

    </div>

    <!-- Scripts -->
    <script src="js/storage.js"></script>
    <script src="data/test-data.js"></script>
    <script src="js/deepgram-voice.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <!-- Load app.js as ES6 module -->
    <script type="module" src="js/app.js"></script>

    <!-- PWA Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(registration => console.log('SW registered'))
                .catch(error => console.log('SW registration failed'));
        }
    </script>
</body>
</html>